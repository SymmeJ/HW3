---
title: "STATS506 Homework3"
author: "Haichao Ji"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r}
rm(list = ls())
setwd(getwd())
```


# (1)

Global level git configuration files locate in $C:\backslash Users\backslash username\backslash .gitconfig$ and lobal level git configuration files locate in $<git-repo>\backslash .git\backslash config$ for Windows.\\

credential.helper=osxkeychain

filter.lfs.clean=git-lfs clean -- %f

filter.lfs.smudge=git-lfs smudge -- %f

filter.lfs.process=git-lfs filter-process

filter.lfs.required=true

user.name=Symmes

user.email=haichao1121$@$gmail.com

# (2)

```{r}
readLines = function(n1,n2){
nms = read.delim("Data/2020_Business_Academic_QCQ.txt",header = FALSE, sep = ',', nrows = 1)
df = read.delim("Data/2020_Business_Academic_QCQ.txt",header = FALSE, sep = ',', nrows = n2 - n1, skip = n1, fileEncoding="latin1")
names(df) <- nms
df[df==""] <- NA
res = na.omit(df[,c(4,7,28,29,45)])
names(res) <- c("state","county_code","employee_size","sales_volume","census_tract")
res
}
```

# (3)

```{r}
df1 = data.frame(row.names = c("state","county_code","employee_size","sales_volume","census_tract"))
for(i in 1:15){
  df = readLines(20000*(i-1)+1,20000*i+1)
  df1 = rbind(df1,df)
}
library(dplyr)
df1 = summarise(group_by(res3,census_tract),sum(employee_size),sum(sales_volume))
names(df1) <- c("census_tract","employee_size","sales_volume")
```

# (4)

```{r}
library(RMySQL)
library(DBI)
mydb <- dbConnect(MySQL(), user='root', password='jhcbywzfb7', dbname='Hw3db',host = "localhost", port = 3306)
dbWriteTable(mydb, value = df1, name = "df1", overwrite = TRUE)
```

# (5)

```{r}
dbGetQuery(mydb, 'SELECT census_tract FROM df1 ORDER BY sales_volume DESC LIMIT 10')
```

# (6)

On git by "git checkout -b new_branch".

# (7)

```{r}
dat7 = read.csv("Data/AL.csv", header = TRUE)
```
```{r}
dat7 = dat7[,c(19,20,22,45,64,65)]
names(dat7) <- c("wealth_finder_score","find_div_1000","estimated_home_value_div_1000","state","census_2010_county_code","census_2010_tract")
dat7 = dat7[dat7$estimated_home_value_div_1000 != 0,]
dat7 = summarise(group_by(dat7,census_2010_tract),mean(wealth_finder_score),mean(find_div_1000),mean(estimated_home_value_div_1000),mean(census_2010_county_code))
names(dat7) <- c("census_2010_tract","wealth_finder_score","find_div_1000","estimated_home_value_div_1000","census_2010_county_code")
df2 = dat7
```

# (8)

```{r}
dbWriteTable(mydb, value = df2, name = "df2",, overwrite = TRUE)
```

# (9)

HEAD is the current branch.

# (10)

```{r}
library(tidycensus)
dat10white = tidycensus::get_decennial(geography = "tract", state = c('AL'), variables = c("H006002"), year = 2010, geometry = TRUE)
dat10black = tidycensus::get_decennial(geography = "tract", state = c('AL'), variables = c("H006003"), year = 2010, geometry = TRUE)
dat10asian = tidycensus::get_decennial(geography = "tract", state = c('AL'), variables = c("H006005"), year = 2010, geometry = TRUE)
tract = tidycensus::get_decennial(geography = "tract", state = c('AL'), variables = c("TRACT"), year = 2010, geometry = TRUE)
dat10 = data.frame(GEOID = as.integer(dat10asian$GEOID), white = dat10white$value, black = dat10black$value, asian = dat10asian$value)
tract = data.frame(GEOID = as.integer(tract$GEOID), tract = tract$value)
df3 = merge(x = dat10, y = tract, by.x = "GEOID", by.y = "GEOID", all.x = TRUE, all.y = FALSE)
dbWriteTable(mydb, value = df3, name = "df3", overwrite = TRUE)
```

# (11)

```{r}
df23 = dbGetQuery(mydb, 'SELECT df3.white, df3.black, df3.asian, df3.tract, 
                  df2.wealth_finder_score, df2.find_div_1000,
                  df2.estimated_home_value_div_1000
                  FROM df2 LEFT JOIN df3 ON df3.tract = df2.census_2010_tract')
df11 = dbGetQuery(mydb, 'SELECT * FROM df1')
df = merge(x = df23, y = df11[,-1], by.x = "tract", by.y = "census_tract",all.x = TRUE, all.y = FALSE)
```

# (12)

